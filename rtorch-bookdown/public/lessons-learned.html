<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Lessons Learned | A Minimal rTorch Tutorial</title>
  <meta name="description" content="This is a minimal tutorial of using the rTorch package to have fun while doing machine learning. This book was produced with bookdown." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Lessons Learned | A Minimal rTorch Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal tutorial of using the rTorch package to have fun while doing machine learning. This book was produced with bookdown." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Lessons Learned | A Minimal rTorch Tutorial" />
  
  <meta name="twitter:description" content="This is a minimal tutorial of using the rTorch package to have fun while doing machine learning. This book was produced with bookdown." />
  

<meta name="author" content="Alfonso R. Reyes" />


<meta name="date" content="2019-09-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="tensors.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal rTorch Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites {-}</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#python-anaconda"><i class="fa fa-check"></i>Python Anaconda</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#example"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#automatic-installation"><i class="fa fa-check"></i>Automatic installation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>2.1</b> Motivation</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#how-do-we-start-using-rtorch"><i class="fa fa-check"></i><b>2.2</b> How do we start using <code>rTorch</code></a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#getting-the-pytorch-version"><i class="fa fa-check"></i><b>2.2.1</b> Getting the PyTorch version</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#pytorch-configuration"><i class="fa fa-check"></i><b>2.2.2</b> PyTorch configuration</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#what-can-you-do-with-rtorch"><i class="fa fa-check"></i><b>2.3</b> What can you do with <code>rTorch</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#the-torchvision-module"><i class="fa fa-check"></i><b>2.3.1</b> The <code>torchvision</code> module</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#np-the-numpy-module"><i class="fa fa-check"></i><b>2.3.2</b> <code>np</code>: the <code>numpy</code> module</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro.html"><a href="intro.html#python-built-in-functions"><i class="fa fa-check"></i><b>2.3.3</b> Python built-in functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lessons-learned.html"><a href="lessons-learned.html"><i class="fa fa-check"></i><b>3</b> Lessons Learned</a><ul>
<li class="chapter" data-level="3.1" data-path="lessons-learned.html"><a href="lessons-learned.html#calling-objects-from-pytorch"><i class="fa fa-check"></i><b>3.1</b> Calling objects from PyTorch</a></li>
<li class="chapter" data-level="3.2" data-path="lessons-learned.html"><a href="lessons-learned.html#call-a-module-from-pytorch"><i class="fa fa-check"></i><b>3.2</b> Call a module from PyTorch</a></li>
<li class="chapter" data-level="3.3" data-path="lessons-learned.html"><a href="lessons-learned.html#show-the-attributes-methods-of-a-class-or-pytorch-object"><i class="fa fa-check"></i><b>3.3</b> Show the attributes (methods) of a class or PyTorch object</a></li>
<li class="chapter" data-level="3.4" data-path="lessons-learned.html"><a href="lessons-learned.html#enumeration"><i class="fa fa-check"></i><b>3.4</b> Enumeration</a></li>
<li class="chapter" data-level="3.5" data-path="lessons-learned.html"><a href="lessons-learned.html#how-to-iterate"><i class="fa fa-check"></i><b>3.5</b> How to iterate</a><ul>
<li class="chapter" data-level="3.5.1" data-path="lessons-learned.html"><a href="lessons-learned.html#using-enumerate-and-iterate"><i class="fa fa-check"></i><b>3.5.1</b> Using <code>enumerate</code> and <code>iterate</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="lessons-learned.html"><a href="lessons-learned.html#using-a-for-loop-to-iterate"><i class="fa fa-check"></i><b>3.5.2</b> Using a <code>for-loop</code> to iterate</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="lessons-learned.html"><a href="lessons-learned.html#zero-gradient"><i class="fa fa-check"></i><b>3.6</b> Zero gradient</a><ul>
<li class="chapter" data-level="3.6.1" data-path="lessons-learned.html"><a href="lessons-learned.html#version-in-python"><i class="fa fa-check"></i><b>3.6.1</b> Version in Python</a></li>
<li class="chapter" data-level="3.6.2" data-path="lessons-learned.html"><a href="lessons-learned.html#version-in-r"><i class="fa fa-check"></i><b>3.6.2</b> Version in R</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="lessons-learned.html"><a href="lessons-learned.html#transform-a-tensor"><i class="fa fa-check"></i><b>3.7</b> Transform a tensor</a></li>
<li class="chapter" data-level="3.8" data-path="lessons-learned.html"><a href="lessons-learned.html#build-a-model-class"><i class="fa fa-check"></i><b>3.8</b> Build a model class</a><ul>
<li class="chapter" data-level="3.8.1" data-path="lessons-learned.html"><a href="lessons-learned.html#example-1"><i class="fa fa-check"></i><b>3.8.1</b> Example 1</a></li>
<li class="chapter" data-level="3.8.2" data-path="lessons-learned.html"><a href="lessons-learned.html#example-2"><i class="fa fa-check"></i><b>3.8.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="lessons-learned.html"><a href="lessons-learned.html#convert-a-tensor-to-numpy-object"><i class="fa fa-check"></i><b>3.9</b> Convert a tensor to <code>numpy</code> object</a></li>
<li class="chapter" data-level="3.10" data-path="lessons-learned.html"><a href="lessons-learned.html#convert-a-numpy-object-to-an-r-object"><i class="fa fa-check"></i><b>3.10</b> Convert a <code>numpy</code> object to an <code>R</code> object</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tensors.html"><a href="tensors.html"><i class="fa fa-check"></i><b>4</b> Tensors</a><ul>
<li class="chapter" data-level="4.1" data-path="tensors.html"><a href="tensors.html#arithmetic-of-tensors"><i class="fa fa-check"></i><b>4.1</b> Arithmetic of tensors</a></li>
<li class="chapter" data-level="4.2" data-path="tensors.html"><a href="tensors.html#boolean-operations"><i class="fa fa-check"></i><b>4.2</b> Boolean operations</a></li>
<li class="chapter" data-level="4.3" data-path="tensors.html"><a href="tensors.html#slicing"><i class="fa fa-check"></i><b>4.3</b> Slicing</a></li>
<li class="chapter" data-level="4.4" data-path="tensors.html"><a href="tensors.html#example-3"><i class="fa fa-check"></i><b>4.4</b> Example</a><ul>
<li class="chapter" data-level="4.4.1" data-path="tensors.html"><a href="tensors.html#load-the-libraries"><i class="fa fa-check"></i><b>4.4.1</b> Load the libraries</a></li>
<li class="chapter" data-level="4.4.2" data-path="tensors.html"><a href="tensors.html#datasets"><i class="fa fa-check"></i><b>4.4.2</b> Datasets</a></li>
<li class="chapter" data-level="4.4.3" data-path="tensors.html"><a href="tensors.html#run-the-model"><i class="fa fa-check"></i><b>4.4.3</b> Run the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linearalgebra.html"><a href="linearalgebra.html"><i class="fa fa-check"></i><b>5</b> Linear Algebra with Torch</a><ul>
<li class="chapter" data-level="5.1" data-path="linearalgebra.html"><a href="linearalgebra.html#scalars"><i class="fa fa-check"></i><b>5.1</b> Scalars</a></li>
<li class="chapter" data-level="5.2" data-path="linearalgebra.html"><a href="linearalgebra.html#vectors"><i class="fa fa-check"></i><b>5.2</b> Vectors</a></li>
<li class="chapter" data-level="5.3" data-path="linearalgebra.html"><a href="linearalgebra.html#matrices"><i class="fa fa-check"></i><b>5.3</b> Matrices</a></li>
<li class="chapter" data-level="5.4" data-path="linearalgebra.html"><a href="linearalgebra.html#d-tensors"><i class="fa fa-check"></i><b>5.4</b> 3D+ tensors</a></li>
<li class="chapter" data-level="5.5" data-path="linearalgebra.html"><a href="linearalgebra.html#transpose-of-a-matrix"><i class="fa fa-check"></i><b>5.5</b> Transpose of a matrix</a></li>
<li class="chapter" data-level="5.6" data-path="linearalgebra.html"><a href="linearalgebra.html#vectors-special-case-of-a-matrix"><i class="fa fa-check"></i><b>5.6</b> Vectors, special case of a matrix</a></li>
<li class="chapter" data-level="5.7" data-path="linearalgebra.html"><a href="linearalgebra.html#tensor-arithmetic"><i class="fa fa-check"></i><b>5.7</b> Tensor arithmetic</a></li>
<li class="chapter" data-level="5.8" data-path="linearalgebra.html"><a href="linearalgebra.html#add-a-scalar-to-a-tensor"><i class="fa fa-check"></i><b>5.8</b> Add a scalar to a tensor</a></li>
<li class="chapter" data-level="5.9" data-path="linearalgebra.html"><a href="linearalgebra.html#multiplying-tensors"><i class="fa fa-check"></i><b>5.9</b> Multiplying tensors</a></li>
<li class="chapter" data-level="5.10" data-path="linearalgebra.html"><a href="linearalgebra.html#dot-product"><i class="fa fa-check"></i><b>5.10</b> Dot product</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>6</b> Linear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="linear-regression.html"><a href="linear-regression.html#case-1-simple-linear-regression"><i class="fa fa-check"></i><b>6.1</b> Case 1: simple linear regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="linear-regression.html"><a href="linear-regression.html#creating-the-network-model"><i class="fa fa-check"></i><b>6.1.1</b> Creating the network model</a></li>
<li class="chapter" data-level="6.1.2" data-path="linear-regression.html"><a href="linear-regression.html#datasets-1"><i class="fa fa-check"></i><b>6.1.2</b> Datasets</a></li>
<li class="chapter" data-level="6.1.3" data-path="linear-regression.html"><a href="linear-regression.html#converting-from-numpy-to-tensor"><i class="fa fa-check"></i><b>6.1.3</b> Converting from numpy to tensor</a></li>
<li class="chapter" data-level="6.1.4" data-path="linear-regression.html"><a href="linear-regression.html#optimizer-and-loss"><i class="fa fa-check"></i><b>6.1.4</b> Optimizer and Loss</a></li>
<li class="chapter" data-level="6.1.5" data-path="linear-regression.html"><a href="linear-regression.html#training"><i class="fa fa-check"></i><b>6.1.5</b> Training</a></li>
<li class="chapter" data-level="6.1.6" data-path="linear-regression.html"><a href="linear-regression.html#result"><i class="fa fa-check"></i><b>6.1.6</b> Result</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="linear-regression.html"><a href="linear-regression.html#case-2-rainfall"><i class="fa fa-check"></i><b>6.2</b> Case 2: Rainfall</a><ul>
<li class="chapter" data-level="6.2.1" data-path="linear-regression.html"><a href="linear-regression.html#select-device"><i class="fa fa-check"></i><b>6.2.1</b> Select device</a></li>
<li class="chapter" data-level="6.2.2" data-path="linear-regression.html"><a href="linear-regression.html#training-data"><i class="fa fa-check"></i><b>6.2.2</b> Training data</a></li>
<li class="chapter" data-level="6.2.3" data-path="linear-regression.html"><a href="linear-regression.html#convert-to-tensors"><i class="fa fa-check"></i><b>6.2.3</b> Convert to tensors</a></li>
<li class="chapter" data-level="6.2.4" data-path="linear-regression.html"><a href="linear-regression.html#build-the-model"><i class="fa fa-check"></i><b>6.2.4</b> Build the model</a></li>
<li class="chapter" data-level="6.2.5" data-path="linear-regression.html"><a href="linear-regression.html#generate-predictions"><i class="fa fa-check"></i><b>6.2.5</b> Generate predictions</a></li>
<li class="chapter" data-level="6.2.6" data-path="linear-regression.html"><a href="linear-regression.html#loss-function"><i class="fa fa-check"></i><b>6.2.6</b> Loss Function</a></li>
<li class="chapter" data-level="6.2.7" data-path="linear-regression.html"><a href="linear-regression.html#compute-gradients"><i class="fa fa-check"></i><b>6.2.7</b> Compute Gradients</a></li>
<li class="chapter" data-level="6.2.8" data-path="linear-regression.html"><a href="linear-regression.html#adjust-weights-and-biases-using-gradient-descent"><i class="fa fa-check"></i><b>6.2.8</b> Adjust weights and biases using gradient descent</a></li>
<li class="chapter" data-level="6.2.9" data-path="linear-regression.html"><a href="linear-regression.html#train-for-multiple-epochs"><i class="fa fa-check"></i><b>6.2.9</b> Train for multiple epochs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>7</b> Logistic Regression</a><ul>
<li class="chapter" data-level="7.1" data-path="logistic-regression.html"><a href="logistic-regression.html#example-1-mnist-handwritten-digits"><i class="fa fa-check"></i><b>7.1</b> Example 1: MNIST handwritten digits</a><ul>
<li class="chapter" data-level="7.1.1" data-path="logistic-regression.html"><a href="logistic-regression.html#hyperparameters"><i class="fa fa-check"></i><b>7.1.1</b> Hyperparameters</a></li>
<li class="chapter" data-level="7.1.2" data-path="logistic-regression.html"><a href="logistic-regression.html#read-datasets"><i class="fa fa-check"></i><b>7.1.2</b> Read datasets</a></li>
<li class="chapter" data-level="7.1.3" data-path="logistic-regression.html"><a href="logistic-regression.html#define-the-model"><i class="fa fa-check"></i><b>7.1.3</b> Define the model</a></li>
<li class="chapter" data-level="7.1.4" data-path="logistic-regression.html"><a href="logistic-regression.html#training-1"><i class="fa fa-check"></i><b>7.1.4</b> Training</a></li>
<li class="chapter" data-level="7.1.5" data-path="logistic-regression.html"><a href="logistic-regression.html#prediction"><i class="fa fa-check"></i><b>7.1.5</b> Prediction</a></li>
<li class="chapter" data-level="7.1.6" data-path="logistic-regression.html"><a href="logistic-regression.html#save-the-model"><i class="fa fa-check"></i><b>7.1.6</b> Save the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="neural-networks.html"><a href="neural-networks.html"><i class="fa fa-check"></i><b>8</b> Neural Networks</a><ul>
<li class="chapter" data-level="8.1" data-path="neural-networks.html"><a href="neural-networks.html#code-in-rtorch"><i class="fa fa-check"></i><b>8.1</b> Code in rTorch</a><ul>
<li class="chapter" data-level="8.1.1" data-path="neural-networks.html"><a href="neural-networks.html#select-device-1"><i class="fa fa-check"></i><b>8.1.1</b> Select device</a></li>
<li class="chapter" data-level="8.1.2" data-path="neural-networks.html"><a href="neural-networks.html#create-the-datasets"><i class="fa fa-check"></i><b>8.1.2</b> Create the datasets</a></li>
<li class="chapter" data-level="8.1.3" data-path="neural-networks.html"><a href="neural-networks.html#define-the-model-1"><i class="fa fa-check"></i><b>8.1.3</b> Define the model</a></li>
<li class="chapter" data-level="8.1.4" data-path="neural-networks.html"><a href="neural-networks.html#loss-function-1"><i class="fa fa-check"></i><b>8.1.4</b> Loss function</a></li>
<li class="chapter" data-level="8.1.5" data-path="neural-networks.html"><a href="neural-networks.html#iterate-through-batches"><i class="fa fa-check"></i><b>8.1.5</b> Iterate through batches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datasets-in-pytorch.html"><a href="datasets-in-pytorch.html"><i class="fa fa-check"></i><b>9</b> Datasets in PyTorch</a></li>
<li class="chapter" data-level="10" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html"><i class="fa fa-check"></i><b>10</b> Simple Regression with PyTorch</a><ul>
<li class="chapter" data-level="10.1" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#creating-the-network-model-1"><i class="fa fa-check"></i><b>10.1</b> Creating the network model</a><ul>
<li class="chapter" data-level="10.1.1" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#code-in-r"><i class="fa fa-check"></i><b>10.1.1</b> Code in R</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#datasets-2"><i class="fa fa-check"></i><b>10.2</b> Datasets</a><ul>
<li class="chapter" data-level="10.2.1" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#code-in-r-1"><i class="fa fa-check"></i><b>10.2.1</b> Code in R</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#optimizer-and-loss-1"><i class="fa fa-check"></i><b>10.3</b> Optimizer and Loss</a><ul>
<li class="chapter" data-level="10.3.1" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#equivalent-code-in-r"><i class="fa fa-check"></i><b>10.3.1</b> Equivalent code in R</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#training-2"><i class="fa fa-check"></i><b>10.4</b> Training</a><ul>
<li class="chapter" data-level="10.4.1" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#code-in-python"><i class="fa fa-check"></i><b>10.4.1</b> Code in Python</a></li>
<li class="chapter" data-level="10.4.2" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#code-in-r-2"><i class="fa fa-check"></i><b>10.4.2</b> Code in R</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="simple-regression-with-pytorch.html"><a href="simple-regression-with-pytorch.html#result-1"><i class="fa fa-check"></i><b>10.5</b> Result</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bookdown-tips.html"><a href="bookdown-tips.html"><i class="fa fa-check"></i>Bookdown tips</a><ul>
<li class="chapter" data-level="" data-path="bookdown-tips.html"><a href="bookdown-tips.html#label-references"><i class="fa fa-check"></i>Label references</a></li>
<li class="chapter" data-level="" data-path="bookdown-tips.html"><a href="bookdown-tips.html#figures-and-tables-with-references"><i class="fa fa-check"></i>Figures and Tables with references</a></li>
<li class="chapter" data-level="" data-path="bookdown-tips.html"><a href="bookdown-tips.html#long-captions"><i class="fa fa-check"></i>Long captions</a></li>
<li class="chapter" data-level="" data-path="bookdown-tips.html"><a href="bookdown-tips.html#citations-and-bibiliography"><i class="fa fa-check"></i>Citations and Bibiliography</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal rTorch Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lessons-learned" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Lessons Learned</h1>
<p>This chapter will explain the main differences between <code>PyTorch</code> and <code>rTorch</code>.
Most of the things work directly in <code>PyTorch</code> but we need to be aware of some minor differences when working with rTorch.</p>
<p>Here is a review of existing methods.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">library</span>(rTorch)</a></code></pre></div>
<div id="calling-objects-from-pytorch" class="section level2">
<h2><span class="header-section-number">3.1</span> Calling objects from PyTorch</h2>
<p>We use the dollar sign or <code>$</code> to call a class, function or method from the <code>torch</code> module.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">torch<span class="op">$</span>tensor</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">#&gt; &lt;built-in method tensor of type&gt;</span></a></code></pre></div>
</div>
<div id="call-a-module-from-pytorch" class="section level2">
<h2><span class="header-section-number">3.2</span> Call a module from PyTorch</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># these are the equivalents of import module</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">nn          &lt;-<span class="st"> </span>torch<span class="op">$</span>nn</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">transforms  &lt;-<span class="st"> </span>torchvision<span class="op">$</span>transforms</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">dsets       &lt;-<span class="st"> </span>torchvision<span class="op">$</span>datasets</a></code></pre></div>
<p>Then we can proceed to extract classes, methods and functions from the <code>nn</code>, <code>transforms</code>, and <code>dsets</code> objects.</p>
</div>
<div id="show-the-attributes-methods-of-a-class-or-pytorch-object" class="section level2">
<h2><span class="header-section-number">3.3</span> Show the attributes (methods) of a class or PyTorch object</h2>
<p>Sometimes we are interested in knowing the internal components of a class. In that case, we use the reticulate function <code>py_list_attributes()</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">local_folder &lt;-<span class="st"> &#39;../datasets/mnist_digits&#39;</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">train_dataset =<span class="st"> </span>torchvision<span class="op">$</span>datasets<span class="op">$</span><span class="kw">MNIST</span>(<span class="dt">root =</span> local_folder, </a>
<a class="sourceLine" id="cb23-3" data-line-number="3">                                           <span class="dt">train =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb23-4" data-line-number="4">                                           <span class="dt">transform =</span> transforms<span class="op">$</span><span class="kw">ToTensor</span>(),</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">                                           <span class="dt">download =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6"></a>
<a class="sourceLine" id="cb23-7" data-line-number="7">train_dataset</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">#&gt; Dataset MNIST</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="co">#&gt;     Number of datapoints: 60000</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co">#&gt;     Root location: ../datasets/mnist_digits</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="co">#&gt;     Split: Train</span></a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">reticulate<span class="op">::</span><span class="kw">py_list_attributes</span>(train_dataset)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co">#&gt;  [1] &quot;__add__&quot;                &quot;__class__&quot;             </span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt;  [3] &quot;__delattr__&quot;            &quot;__dict__&quot;              </span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt;  [5] &quot;__dir__&quot;                &quot;__doc__&quot;               </span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt;  [7] &quot;__eq__&quot;                 &quot;__format__&quot;            </span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt;  [9] &quot;__ge__&quot;                 &quot;__getattribute__&quot;      </span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; [11] &quot;__getitem__&quot;            &quot;__gt__&quot;                </span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; [13] &quot;__hash__&quot;               &quot;__init__&quot;              </span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; [15] &quot;__init_subclass__&quot;      &quot;__le__&quot;                </span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; [17] &quot;__len__&quot;                &quot;__lt__&quot;                </span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt; [19] &quot;__module__&quot;             &quot;__ne__&quot;                </span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt; [21] &quot;__new__&quot;                &quot;__reduce__&quot;            </span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt; [23] &quot;__reduce_ex__&quot;          &quot;__repr__&quot;              </span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt; [25] &quot;__setattr__&quot;            &quot;__sizeof__&quot;            </span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt; [27] &quot;__str__&quot;                &quot;__subclasshook__&quot;      </span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt; [29] &quot;__weakref__&quot;            &quot;_check_exists&quot;         </span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt; [31] &quot;_format_transform_repr&quot; &quot;_repr_indent&quot;          </span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt; [33] &quot;class_to_idx&quot;           &quot;classes&quot;               </span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19"><span class="co">#&gt; [35] &quot;data&quot;                   &quot;download&quot;              </span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20"><span class="co">#&gt; [37] &quot;extra_repr&quot;             &quot;extract_gzip&quot;          </span></a>
<a class="sourceLine" id="cb24-21" data-line-number="21"><span class="co">#&gt; [39] &quot;processed_folder&quot;       &quot;raw_folder&quot;            </span></a>
<a class="sourceLine" id="cb24-22" data-line-number="22"><span class="co">#&gt; [41] &quot;root&quot;                   &quot;target_transform&quot;      </span></a>
<a class="sourceLine" id="cb24-23" data-line-number="23"><span class="co">#&gt; [43] &quot;targets&quot;                &quot;test_data&quot;             </span></a>
<a class="sourceLine" id="cb24-24" data-line-number="24"><span class="co">#&gt; [45] &quot;test_file&quot;              &quot;test_labels&quot;           </span></a>
<a class="sourceLine" id="cb24-25" data-line-number="25"><span class="co">#&gt; [47] &quot;train&quot;                  &quot;train_data&quot;            </span></a>
<a class="sourceLine" id="cb24-26" data-line-number="26"><span class="co">#&gt; [49] &quot;train_labels&quot;           &quot;training_file&quot;         </span></a>
<a class="sourceLine" id="cb24-27" data-line-number="27"><span class="co">#&gt; [51] &quot;transform&quot;              &quot;transforms&quot;            </span></a>
<a class="sourceLine" id="cb24-28" data-line-number="28"><span class="co">#&gt; [53] &quot;urls&quot;</span></a></code></pre></div>
<p>Knowing the internal methods of a class could be useful when we want to refer to a specific property of such class. For example, from the list above, we know that the object <code>train_dataset</code> has an attribute <code>__len__</code>. We can call it like this:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">train_dataset<span class="op">$</span><span class="st">`</span><span class="dt">__len__</span><span class="st">`</span>()</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">#&gt; [1] 60000</span></a></code></pre></div>
</div>
<div id="enumeration" class="section level2">
<h2><span class="header-section-number">3.4</span> Enumeration</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">x_train =<span class="st"> </span><span class="kw">array</span>(<span class="kw">c</span>(<span class="fl">3.3</span>, <span class="fl">4.4</span>, <span class="fl">5.5</span>, <span class="fl">6.71</span>, <span class="fl">6.93</span>, <span class="fl">4.168</span>, </a>
<a class="sourceLine" id="cb26-3" data-line-number="3">                  <span class="fl">9.779</span>, <span class="fl">6.182</span>, <span class="fl">7.59</span>, <span class="fl">2.167</span>, <span class="fl">7.042</span>,</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">                  <span class="fl">10.791</span>, <span class="fl">5.313</span>, <span class="fl">7.997</span>, <span class="fl">3.1</span>), <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb26-5" data-line-number="5"></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">x_train &lt;-<span class="st"> </span><span class="kw">r_to_py</span>(x_train)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">x_train &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">from_numpy</span>(x_train)         <span class="co"># convert to tensor</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8">x_train &lt;-<span class="st"> </span>x_train<span class="op">$</span><span class="kw">type</span>(torch<span class="op">$</span>FloatTensor)   <span class="co"># make it a a FloatTensor</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"></a>
<a class="sourceLine" id="cb26-10" data-line-number="10">x_train</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">#&gt; tensor([[ 3.3000],</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">#&gt;         [ 4.4000],</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">#&gt;         [ 5.5000],</span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">#&gt;         [ 6.7100],</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">#&gt;         [ 6.9300],</span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">#&gt;         [ 4.1680],</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="co">#&gt;         [ 9.7790],</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">#&gt;         [ 6.1820],</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">#&gt;         [ 7.5900],</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">#&gt;         [ 2.1670],</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">#&gt;         [ 7.0420],</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">#&gt;         [10.7910],</span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">#&gt;         [ 5.3130],</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">#&gt;         [ 7.9970],</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">#&gt;         [ 3.1000]])</span></a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">x_train<span class="op">$</span><span class="kw">nelement</span>()    <span class="co"># number of elements in the tensor</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co">#&gt; [1] 15</span></a></code></pre></div>
</div>
<div id="how-to-iterate" class="section level2">
<h2><span class="header-section-number">3.5</span> How to iterate</h2>
<div id="using-enumerate-and-iterate" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Using <code>enumerate</code> and <code>iterate</code></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">py =<span class="st"> </span><span class="kw">import_builtins</span>()</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">enum_x_train =<span class="st"> </span>py<span class="op">$</span><span class="kw">enumerate</span>(x_train)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">enum_x_train</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt; &lt;enumerate&gt;</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">py<span class="op">$</span><span class="kw">len</span>(x_train)</a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co">#&gt; [1] 15</span></a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">xit =<span class="st"> </span><span class="kw">iterate</span>(enum_x_train, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">xit</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">#&gt; [[1]][[1]]</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co">#&gt; [[1]][[2]]</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co">#&gt; tensor([3.3000])</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="co">#&gt; [[2]][[1]]</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb29-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-15" data-line-number="15"><span class="co">#&gt; [[2]][[2]]</span></a>
<a class="sourceLine" id="cb29-16" data-line-number="16"><span class="co">#&gt; tensor([4.4000])</span></a>
<a class="sourceLine" id="cb29-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-19" data-line-number="19"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb29-20" data-line-number="20"><span class="co">#&gt; [[3]][[1]]</span></a>
<a class="sourceLine" id="cb29-21" data-line-number="21"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb29-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-23" data-line-number="23"><span class="co">#&gt; [[3]][[2]]</span></a>
<a class="sourceLine" id="cb29-24" data-line-number="24"><span class="co">#&gt; tensor([5.5000])</span></a>
<a class="sourceLine" id="cb29-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-27" data-line-number="27"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb29-28" data-line-number="28"><span class="co">#&gt; [[4]][[1]]</span></a>
<a class="sourceLine" id="cb29-29" data-line-number="29"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb29-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-31" data-line-number="31"><span class="co">#&gt; [[4]][[2]]</span></a>
<a class="sourceLine" id="cb29-32" data-line-number="32"><span class="co">#&gt; tensor([6.7100])</span></a>
<a class="sourceLine" id="cb29-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-34" data-line-number="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-35" data-line-number="35"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb29-36" data-line-number="36"><span class="co">#&gt; [[5]][[1]]</span></a>
<a class="sourceLine" id="cb29-37" data-line-number="37"><span class="co">#&gt; [1] 4</span></a>
<a class="sourceLine" id="cb29-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-39" data-line-number="39"><span class="co">#&gt; [[5]][[2]]</span></a>
<a class="sourceLine" id="cb29-40" data-line-number="40"><span class="co">#&gt; tensor([6.9300])</span></a>
<a class="sourceLine" id="cb29-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-42" data-line-number="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-43" data-line-number="43"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb29-44" data-line-number="44"><span class="co">#&gt; [[6]][[1]]</span></a>
<a class="sourceLine" id="cb29-45" data-line-number="45"><span class="co">#&gt; [1] 5</span></a>
<a class="sourceLine" id="cb29-46" data-line-number="46"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-47" data-line-number="47"><span class="co">#&gt; [[6]][[2]]</span></a>
<a class="sourceLine" id="cb29-48" data-line-number="48"><span class="co">#&gt; tensor([4.1680])</span></a>
<a class="sourceLine" id="cb29-49" data-line-number="49"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-50" data-line-number="50"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-51" data-line-number="51"><span class="co">#&gt; [[7]]</span></a>
<a class="sourceLine" id="cb29-52" data-line-number="52"><span class="co">#&gt; [[7]][[1]]</span></a>
<a class="sourceLine" id="cb29-53" data-line-number="53"><span class="co">#&gt; [1] 6</span></a>
<a class="sourceLine" id="cb29-54" data-line-number="54"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-55" data-line-number="55"><span class="co">#&gt; [[7]][[2]]</span></a>
<a class="sourceLine" id="cb29-56" data-line-number="56"><span class="co">#&gt; tensor([9.7790])</span></a>
<a class="sourceLine" id="cb29-57" data-line-number="57"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-58" data-line-number="58"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-59" data-line-number="59"><span class="co">#&gt; [[8]]</span></a>
<a class="sourceLine" id="cb29-60" data-line-number="60"><span class="co">#&gt; [[8]][[1]]</span></a>
<a class="sourceLine" id="cb29-61" data-line-number="61"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb29-62" data-line-number="62"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-63" data-line-number="63"><span class="co">#&gt; [[8]][[2]]</span></a>
<a class="sourceLine" id="cb29-64" data-line-number="64"><span class="co">#&gt; tensor([6.1820])</span></a>
<a class="sourceLine" id="cb29-65" data-line-number="65"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-66" data-line-number="66"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-67" data-line-number="67"><span class="co">#&gt; [[9]]</span></a>
<a class="sourceLine" id="cb29-68" data-line-number="68"><span class="co">#&gt; [[9]][[1]]</span></a>
<a class="sourceLine" id="cb29-69" data-line-number="69"><span class="co">#&gt; [1] 8</span></a>
<a class="sourceLine" id="cb29-70" data-line-number="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-71" data-line-number="71"><span class="co">#&gt; [[9]][[2]]</span></a>
<a class="sourceLine" id="cb29-72" data-line-number="72"><span class="co">#&gt; tensor([7.5900])</span></a>
<a class="sourceLine" id="cb29-73" data-line-number="73"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-74" data-line-number="74"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-75" data-line-number="75"><span class="co">#&gt; [[10]]</span></a>
<a class="sourceLine" id="cb29-76" data-line-number="76"><span class="co">#&gt; [[10]][[1]]</span></a>
<a class="sourceLine" id="cb29-77" data-line-number="77"><span class="co">#&gt; [1] 9</span></a>
<a class="sourceLine" id="cb29-78" data-line-number="78"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-79" data-line-number="79"><span class="co">#&gt; [[10]][[2]]</span></a>
<a class="sourceLine" id="cb29-80" data-line-number="80"><span class="co">#&gt; tensor([2.1670])</span></a>
<a class="sourceLine" id="cb29-81" data-line-number="81"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-82" data-line-number="82"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-83" data-line-number="83"><span class="co">#&gt; [[11]]</span></a>
<a class="sourceLine" id="cb29-84" data-line-number="84"><span class="co">#&gt; [[11]][[1]]</span></a>
<a class="sourceLine" id="cb29-85" data-line-number="85"><span class="co">#&gt; [1] 10</span></a>
<a class="sourceLine" id="cb29-86" data-line-number="86"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-87" data-line-number="87"><span class="co">#&gt; [[11]][[2]]</span></a>
<a class="sourceLine" id="cb29-88" data-line-number="88"><span class="co">#&gt; tensor([7.0420])</span></a>
<a class="sourceLine" id="cb29-89" data-line-number="89"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-90" data-line-number="90"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-91" data-line-number="91"><span class="co">#&gt; [[12]]</span></a>
<a class="sourceLine" id="cb29-92" data-line-number="92"><span class="co">#&gt; [[12]][[1]]</span></a>
<a class="sourceLine" id="cb29-93" data-line-number="93"><span class="co">#&gt; [1] 11</span></a>
<a class="sourceLine" id="cb29-94" data-line-number="94"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-95" data-line-number="95"><span class="co">#&gt; [[12]][[2]]</span></a>
<a class="sourceLine" id="cb29-96" data-line-number="96"><span class="co">#&gt; tensor([10.7910])</span></a>
<a class="sourceLine" id="cb29-97" data-line-number="97"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-98" data-line-number="98"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-99" data-line-number="99"><span class="co">#&gt; [[13]]</span></a>
<a class="sourceLine" id="cb29-100" data-line-number="100"><span class="co">#&gt; [[13]][[1]]</span></a>
<a class="sourceLine" id="cb29-101" data-line-number="101"><span class="co">#&gt; [1] 12</span></a>
<a class="sourceLine" id="cb29-102" data-line-number="102"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-103" data-line-number="103"><span class="co">#&gt; [[13]][[2]]</span></a>
<a class="sourceLine" id="cb29-104" data-line-number="104"><span class="co">#&gt; tensor([5.3130])</span></a>
<a class="sourceLine" id="cb29-105" data-line-number="105"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-106" data-line-number="106"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-107" data-line-number="107"><span class="co">#&gt; [[14]]</span></a>
<a class="sourceLine" id="cb29-108" data-line-number="108"><span class="co">#&gt; [[14]][[1]]</span></a>
<a class="sourceLine" id="cb29-109" data-line-number="109"><span class="co">#&gt; [1] 13</span></a>
<a class="sourceLine" id="cb29-110" data-line-number="110"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-111" data-line-number="111"><span class="co">#&gt; [[14]][[2]]</span></a>
<a class="sourceLine" id="cb29-112" data-line-number="112"><span class="co">#&gt; tensor([7.9970])</span></a>
<a class="sourceLine" id="cb29-113" data-line-number="113"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-114" data-line-number="114"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-115" data-line-number="115"><span class="co">#&gt; [[15]]</span></a>
<a class="sourceLine" id="cb29-116" data-line-number="116"><span class="co">#&gt; [[15]][[1]]</span></a>
<a class="sourceLine" id="cb29-117" data-line-number="117"><span class="co">#&gt; [1] 14</span></a>
<a class="sourceLine" id="cb29-118" data-line-number="118"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-119" data-line-number="119"><span class="co">#&gt; [[15]][[2]]</span></a>
<a class="sourceLine" id="cb29-120" data-line-number="120"><span class="co">#&gt; tensor([3.1000])</span></a></code></pre></div>
</div>
<div id="using-a-for-loop-to-iterate" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Using a <code>for-loop</code> to iterate</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># reset the iterator</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">enum_x_train =<span class="st"> </span>py<span class="op">$</span><span class="kw">enumerate</span>(x_train)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>py<span class="op">$</span><span class="kw">len</span>(x_train)) {</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">    obj &lt;-<span class="st"> </span><span class="kw">iter_next</span>(enum_x_train)    <span class="co"># next item</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6">    <span class="kw">cat</span>(obj[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)     <span class="co"># 1st part or index</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7">    <span class="kw">print</span>(obj[[<span class="dv">2</span>]])         <span class="co"># 2nd part or tensor</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#&gt; 0    tensor([3.3000])</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="co">#&gt; 1    tensor([4.4000])</span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co">#&gt; 2    tensor([5.5000])</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co">#&gt; 3    tensor([6.7100])</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="co">#&gt; 4    tensor([6.9300])</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#&gt; 5    tensor([4.1680])</span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15"><span class="co">#&gt; 6    tensor([9.7790])</span></a>
<a class="sourceLine" id="cb30-16" data-line-number="16"><span class="co">#&gt; 7    tensor([6.1820])</span></a>
<a class="sourceLine" id="cb30-17" data-line-number="17"><span class="co">#&gt; 8    tensor([7.5900])</span></a>
<a class="sourceLine" id="cb30-18" data-line-number="18"><span class="co">#&gt; 9    tensor([2.1670])</span></a>
<a class="sourceLine" id="cb30-19" data-line-number="19"><span class="co">#&gt; 10   tensor([7.0420])</span></a>
<a class="sourceLine" id="cb30-20" data-line-number="20"><span class="co">#&gt; 11   tensor([10.7910])</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21"><span class="co">#&gt; 12   tensor([5.3130])</span></a>
<a class="sourceLine" id="cb30-22" data-line-number="22"><span class="co">#&gt; 13   tensor([7.9970])</span></a>
<a class="sourceLine" id="cb30-23" data-line-number="23"><span class="co">#&gt; 14   tensor([3.1000])</span></a></code></pre></div>
<blockquote>
<p>We will find very frequently this kind of iterators when we read a dataset using <code>torchvision</code>. There are different ways to iterate through these objects.</p>
</blockquote>
</div>
</div>
<div id="zero-gradient" class="section level2">
<h2><span class="header-section-number">3.6</span> Zero gradient</h2>
<p>The zero gradient was one of the most difficult to implement in R if we don’t pay attention to the content of the objects carrying the weights and biases. This happens when the algorithm written in PyTorch is not immediately translatable to rTorch. This can be appreciated in this example.</p>
<div id="version-in-python" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Version in Python</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="im">import</span> torch</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">torch.manual_seed(<span class="dv">0</span>)  <span class="co"># reproducible</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="co"># Input (temp, rainfall, humidity)</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co">#&gt; &lt;torch._C.Generator object at 0x7fec71c73df0&gt;</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">inputs <span class="op">=</span> np.array([[<span class="dv">73</span>, <span class="dv">67</span>, <span class="dv">43</span>],</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">                   [<span class="dv">91</span>, <span class="dv">88</span>, <span class="dv">64</span>],</a>
<a class="sourceLine" id="cb31-10" data-line-number="10">                   [<span class="dv">87</span>, <span class="dv">134</span>, <span class="dv">58</span>],</a>
<a class="sourceLine" id="cb31-11" data-line-number="11">                   [<span class="dv">102</span>, <span class="dv">43</span>, <span class="dv">37</span>],</a>
<a class="sourceLine" id="cb31-12" data-line-number="12">                   [<span class="dv">69</span>, <span class="dv">96</span>, <span class="dv">70</span>]], dtype<span class="op">=</span><span class="st">&#39;float32&#39;</span>)</a>
<a class="sourceLine" id="cb31-13" data-line-number="13"></a>
<a class="sourceLine" id="cb31-14" data-line-number="14"><span class="co"># Targets (apples, oranges)</span></a>
<a class="sourceLine" id="cb31-15" data-line-number="15">targets <span class="op">=</span> np.array([[<span class="dv">56</span>, <span class="dv">70</span>],</a>
<a class="sourceLine" id="cb31-16" data-line-number="16">                    [<span class="dv">81</span>, <span class="dv">101</span>],</a>
<a class="sourceLine" id="cb31-17" data-line-number="17">                    [<span class="dv">119</span>, <span class="dv">133</span>],</a>
<a class="sourceLine" id="cb31-18" data-line-number="18">                    [<span class="dv">22</span>, <span class="dv">37</span>],</a>
<a class="sourceLine" id="cb31-19" data-line-number="19">                    [<span class="dv">103</span>, <span class="dv">119</span>]], dtype<span class="op">=</span><span class="st">&#39;float32&#39;</span>)</a>
<a class="sourceLine" id="cb31-20" data-line-number="20">                    </a>
<a class="sourceLine" id="cb31-21" data-line-number="21"></a>
<a class="sourceLine" id="cb31-22" data-line-number="22"><span class="co"># Convert inputs and targets to tensors</span></a>
<a class="sourceLine" id="cb31-23" data-line-number="23">inputs <span class="op">=</span> torch.from_numpy(inputs)</a>
<a class="sourceLine" id="cb31-24" data-line-number="24">targets <span class="op">=</span> torch.from_numpy(targets)</a>
<a class="sourceLine" id="cb31-25" data-line-number="25"></a>
<a class="sourceLine" id="cb31-26" data-line-number="26"><span class="co"># random weights and biases</span></a>
<a class="sourceLine" id="cb31-27" data-line-number="27">w <span class="op">=</span> torch.randn(<span class="dv">2</span>, <span class="dv">3</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb31-28" data-line-number="28">b <span class="op">=</span> torch.randn(<span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb31-29" data-line-number="29"></a>
<a class="sourceLine" id="cb31-30" data-line-number="30"><span class="co"># function for the model</span></a>
<a class="sourceLine" id="cb31-31" data-line-number="31"><span class="kw">def</span> model(x):</a>
<a class="sourceLine" id="cb31-32" data-line-number="32">  wt <span class="op">=</span> w.t()</a>
<a class="sourceLine" id="cb31-33" data-line-number="33">  mm <span class="op">=</span> x <span class="op">@</span> w.t()</a>
<a class="sourceLine" id="cb31-34" data-line-number="34">  <span class="cf">return</span> x <span class="op">@</span> w.t() <span class="op">+</span> b       <span class="co"># @ represents matrix multiplication in PyTorch</span></a>
<a class="sourceLine" id="cb31-35" data-line-number="35"></a>
<a class="sourceLine" id="cb31-36" data-line-number="36"><span class="co"># MSE loss function</span></a>
<a class="sourceLine" id="cb31-37" data-line-number="37"><span class="kw">def</span> mse(t1, t2):</a>
<a class="sourceLine" id="cb31-38" data-line-number="38">  diff <span class="op">=</span> t1 <span class="op">-</span> t2</a>
<a class="sourceLine" id="cb31-39" data-line-number="39">  <span class="cf">return</span> torch.<span class="bu">sum</span>(diff <span class="op">*</span> diff) <span class="op">/</span> diff.numel()</a>
<a class="sourceLine" id="cb31-40" data-line-number="40"></a>
<a class="sourceLine" id="cb31-41" data-line-number="41"><span class="co"># Running all together</span></a>
<a class="sourceLine" id="cb31-42" data-line-number="42"><span class="co"># Train for 100 epochs</span></a>
<a class="sourceLine" id="cb31-43" data-line-number="43"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</a>
<a class="sourceLine" id="cb31-44" data-line-number="44">  preds <span class="op">=</span> model(inputs)</a>
<a class="sourceLine" id="cb31-45" data-line-number="45">  loss <span class="op">=</span> mse(preds, targets)</a>
<a class="sourceLine" id="cb31-46" data-line-number="46">  loss.backward()</a>
<a class="sourceLine" id="cb31-47" data-line-number="47">  <span class="cf">with</span> torch.no_grad():</a>
<a class="sourceLine" id="cb31-48" data-line-number="48">    w <span class="op">-=</span> w.grad <span class="op">*</span> <span class="fl">0.00001</span></a>
<a class="sourceLine" id="cb31-49" data-line-number="49">    b <span class="op">-=</span> b.grad <span class="op">*</span> <span class="fl">0.00001</span></a>
<a class="sourceLine" id="cb31-50" data-line-number="50">    w_gz <span class="op">=</span> w.grad.zero_()</a>
<a class="sourceLine" id="cb31-51" data-line-number="51">    b_gz <span class="op">=</span> b.grad.zero_()</a>
<a class="sourceLine" id="cb31-52" data-line-number="52">    </a>
<a class="sourceLine" id="cb31-53" data-line-number="53"><span class="co"># Calculate loss</span></a>
<a class="sourceLine" id="cb31-54" data-line-number="54">preds <span class="op">=</span> model(inputs)</a>
<a class="sourceLine" id="cb31-55" data-line-number="55">loss <span class="op">=</span> mse(preds, targets)</a>
<a class="sourceLine" id="cb31-56" data-line-number="56"><span class="bu">print</span>(<span class="st">&quot;Loss: &quot;</span>, loss)    </a>
<a class="sourceLine" id="cb31-57" data-line-number="57"></a>
<a class="sourceLine" id="cb31-58" data-line-number="58"><span class="co"># predictions</span></a>
<a class="sourceLine" id="cb31-59" data-line-number="59"><span class="co">#&gt; Loss:  tensor(1270.1234, grad_fn=&lt;DivBackward0&gt;)</span></a>
<a class="sourceLine" id="cb31-60" data-line-number="60"><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Predictions:&quot;</span>)</a>
<a class="sourceLine" id="cb31-61" data-line-number="61"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb31-62" data-line-number="62"><span class="co">#&gt; Predictions:</span></a>
<a class="sourceLine" id="cb31-63" data-line-number="63">preds</a>
<a class="sourceLine" id="cb31-64" data-line-number="64"></a>
<a class="sourceLine" id="cb31-65" data-line-number="65"><span class="co"># Targets</span></a>
<a class="sourceLine" id="cb31-66" data-line-number="66"><span class="co">#&gt; tensor([[ 69.3122,  80.2639],</span></a>
<a class="sourceLine" id="cb31-67" data-line-number="67"><span class="co">#&gt;         [ 73.7528,  97.2381],</span></a>
<a class="sourceLine" id="cb31-68" data-line-number="68"><span class="co">#&gt;         [118.3933, 124.7628],</span></a>
<a class="sourceLine" id="cb31-69" data-line-number="69"><span class="co">#&gt;         [ 89.6111,  93.0286],</span></a>
<a class="sourceLine" id="cb31-70" data-line-number="70"><span class="co">#&gt;         [ 47.3014,  80.6467]], grad_fn=&lt;AddBackward0&gt;)</span></a>
<a class="sourceLine" id="cb31-71" data-line-number="71"><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Targets:&quot;</span>)</a>
<a class="sourceLine" id="cb31-72" data-line-number="72"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb31-73" data-line-number="73"><span class="co">#&gt; Targets:</span></a>
<a class="sourceLine" id="cb31-74" data-line-number="74">targets</a>
<a class="sourceLine" id="cb31-75" data-line-number="75"><span class="co">#&gt; tensor([[ 56.,  70.],</span></a>
<a class="sourceLine" id="cb31-76" data-line-number="76"><span class="co">#&gt;         [ 81., 101.],</span></a>
<a class="sourceLine" id="cb31-77" data-line-number="77"><span class="co">#&gt;         [119., 133.],</span></a>
<a class="sourceLine" id="cb31-78" data-line-number="78"><span class="co">#&gt;         [ 22.,  37.],</span></a>
<a class="sourceLine" id="cb31-79" data-line-number="79"><span class="co">#&gt;         [103., 119.]])</span></a></code></pre></div>
</div>
<div id="version-in-r" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Version in R</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">library</span>(rTorch)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"></a>
<a class="sourceLine" id="cb32-3" data-line-number="3">torch<span class="op">$</span><span class="kw">manual_seed</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt; &lt;torch._C.Generator&gt;</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">device =<span class="st"> </span>torch<span class="op">$</span><span class="kw">device</span>(<span class="st">&#39;cpu&#39;</span>)</a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co"># Input (temp, rainfall, humidity)</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8">inputs =<span class="st"> </span>np<span class="op">$</span><span class="kw">array</span>(<span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">73</span>, <span class="dv">67</span>, <span class="dv">43</span>),</a>
<a class="sourceLine" id="cb32-9" data-line-number="9">                   <span class="kw">list</span>(<span class="dv">91</span>, <span class="dv">88</span>, <span class="dv">64</span>),</a>
<a class="sourceLine" id="cb32-10" data-line-number="10">                   <span class="kw">list</span>(<span class="dv">87</span>, <span class="dv">134</span>, <span class="dv">58</span>),</a>
<a class="sourceLine" id="cb32-11" data-line-number="11">                   <span class="kw">list</span>(<span class="dv">102</span>, <span class="dv">43</span>, <span class="dv">37</span>),</a>
<a class="sourceLine" id="cb32-12" data-line-number="12">                   <span class="kw">list</span>(<span class="dv">69</span>, <span class="dv">96</span>, <span class="dv">70</span>)), <span class="dt">dtype=</span><span class="st">&#39;float32&#39;</span>)</a>
<a class="sourceLine" id="cb32-13" data-line-number="13"></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="co"># Targets (apples, oranges)</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15">targets =<span class="st"> </span>np<span class="op">$</span><span class="kw">array</span>(<span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">56</span>, <span class="dv">70</span>), </a>
<a class="sourceLine" id="cb32-16" data-line-number="16">                    <span class="kw">list</span>(<span class="dv">81</span>, <span class="dv">101</span>),</a>
<a class="sourceLine" id="cb32-17" data-line-number="17">                    <span class="kw">list</span>(<span class="dv">119</span>, <span class="dv">133</span>),</a>
<a class="sourceLine" id="cb32-18" data-line-number="18">                    <span class="kw">list</span>(<span class="dv">22</span>, <span class="dv">37</span>), </a>
<a class="sourceLine" id="cb32-19" data-line-number="19">                    <span class="kw">list</span>(<span class="dv">103</span>, <span class="dv">119</span>)), <span class="dt">dtype=</span><span class="st">&#39;float32&#39;</span>)</a>
<a class="sourceLine" id="cb32-20" data-line-number="20"></a>
<a class="sourceLine" id="cb32-21" data-line-number="21"></a>
<a class="sourceLine" id="cb32-22" data-line-number="22"><span class="co"># Convert inputs and targets to tensors</span></a>
<a class="sourceLine" id="cb32-23" data-line-number="23">inputs =<span class="st"> </span>torch<span class="op">$</span><span class="kw">from_numpy</span>(inputs)</a>
<a class="sourceLine" id="cb32-24" data-line-number="24">targets =<span class="st"> </span>torch<span class="op">$</span><span class="kw">from_numpy</span>(targets)</a>
<a class="sourceLine" id="cb32-25" data-line-number="25"></a>
<a class="sourceLine" id="cb32-26" data-line-number="26"><span class="co"># random numbers for weights and biases. Then convert to double()</span></a>
<a class="sourceLine" id="cb32-27" data-line-number="27">torch<span class="op">$</span><span class="kw">set_default_dtype</span>(torch<span class="op">$</span>float64)</a>
<a class="sourceLine" id="cb32-28" data-line-number="28"></a>
<a class="sourceLine" id="cb32-29" data-line-number="29">w =<span class="st"> </span>torch<span class="op">$</span><span class="kw">randn</span>(2L, 3L, <span class="dt">requires_grad=</span><span class="ot">TRUE</span>) <span class="co">#$double()</span></a>
<a class="sourceLine" id="cb32-30" data-line-number="30">b =<span class="st"> </span>torch<span class="op">$</span><span class="kw">randn</span>(2L, <span class="dt">requires_grad=</span><span class="ot">TRUE</span>) <span class="co">#$double()</span></a>
<a class="sourceLine" id="cb32-31" data-line-number="31"></a>
<a class="sourceLine" id="cb32-32" data-line-number="32">model &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb32-33" data-line-number="33">  wt &lt;-<span class="st"> </span>w<span class="op">$</span><span class="kw">t</span>()</a>
<a class="sourceLine" id="cb32-34" data-line-number="34">  <span class="kw">return</span>(torch<span class="op">$</span><span class="kw">add</span>(torch<span class="op">$</span><span class="kw">mm</span>(x, wt), b))</a>
<a class="sourceLine" id="cb32-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb32-36" data-line-number="36"></a>
<a class="sourceLine" id="cb32-37" data-line-number="37"><span class="co"># MSE loss</span></a>
<a class="sourceLine" id="cb32-38" data-line-number="38">mse =<span class="st"> </span><span class="cf">function</span>(t1, t2) {</a>
<a class="sourceLine" id="cb32-39" data-line-number="39">  diff &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">sub</span>(t1, t2)</a>
<a class="sourceLine" id="cb32-40" data-line-number="40">  mul &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">sum</span>(torch<span class="op">$</span><span class="kw">mul</span>(diff, diff))</a>
<a class="sourceLine" id="cb32-41" data-line-number="41">  <span class="kw">return</span>(torch<span class="op">$</span><span class="kw">div</span>(mul, diff<span class="op">$</span><span class="kw">numel</span>()))</a>
<a class="sourceLine" id="cb32-42" data-line-number="42">}</a>
<a class="sourceLine" id="cb32-43" data-line-number="43"></a>
<a class="sourceLine" id="cb32-44" data-line-number="44"><span class="co"># Running all together</span></a>
<a class="sourceLine" id="cb32-45" data-line-number="45"><span class="co"># Adjust weights and reset gradients</span></a>
<a class="sourceLine" id="cb32-46" data-line-number="46"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb32-47" data-line-number="47">  preds =<span class="st"> </span><span class="kw">model</span>(inputs)</a>
<a class="sourceLine" id="cb32-48" data-line-number="48">  loss =<span class="st"> </span><span class="kw">mse</span>(preds, targets)</a>
<a class="sourceLine" id="cb32-49" data-line-number="49">  loss<span class="op">$</span><span class="kw">backward</span>()</a>
<a class="sourceLine" id="cb32-50" data-line-number="50">  <span class="kw">with</span>(torch<span class="op">$</span><span class="kw">no_grad</span>(), {</a>
<a class="sourceLine" id="cb32-51" data-line-number="51">    w<span class="op">$</span>data &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">sub</span>(w<span class="op">$</span>data, torch<span class="op">$</span><span class="kw">mul</span>(w<span class="op">$</span>grad, torch<span class="op">$</span><span class="kw">scalar_tensor</span>(<span class="fl">1e-5</span>)))</a>
<a class="sourceLine" id="cb32-52" data-line-number="52">    b<span class="op">$</span>data &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">sub</span>(b<span class="op">$</span>data, torch<span class="op">$</span><span class="kw">mul</span>(b<span class="op">$</span>grad, torch<span class="op">$</span><span class="kw">scalar_tensor</span>(<span class="fl">1e-5</span>)))</a>
<a class="sourceLine" id="cb32-53" data-line-number="53">    </a>
<a class="sourceLine" id="cb32-54" data-line-number="54">    w<span class="op">$</span>grad<span class="op">$</span><span class="kw">zero_</span>()</a>
<a class="sourceLine" id="cb32-55" data-line-number="55">    b<span class="op">$</span>grad<span class="op">$</span><span class="kw">zero_</span>()</a>
<a class="sourceLine" id="cb32-56" data-line-number="56">  })</a>
<a class="sourceLine" id="cb32-57" data-line-number="57">}</a>
<a class="sourceLine" id="cb32-58" data-line-number="58"></a>
<a class="sourceLine" id="cb32-59" data-line-number="59"><span class="co"># Calculate loss</span></a>
<a class="sourceLine" id="cb32-60" data-line-number="60">preds =<span class="st"> </span><span class="kw">model</span>(inputs)</a>
<a class="sourceLine" id="cb32-61" data-line-number="61">loss =<span class="st"> </span><span class="kw">mse</span>(preds, targets)</a>
<a class="sourceLine" id="cb32-62" data-line-number="62"><span class="kw">cat</span>(<span class="st">&quot;Loss: &quot;</span>); <span class="kw">print</span>(loss)</a>
<a class="sourceLine" id="cb32-63" data-line-number="63"><span class="co">#&gt; Loss:</span></a>
<a class="sourceLine" id="cb32-64" data-line-number="64"><span class="co">#&gt; tensor(1270.1237, grad_fn=&lt;DivBackward0&gt;)</span></a>
<a class="sourceLine" id="cb32-65" data-line-number="65"></a>
<a class="sourceLine" id="cb32-66" data-line-number="66"><span class="co"># predictions</span></a>
<a class="sourceLine" id="cb32-67" data-line-number="67"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Predictions:</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb32-68" data-line-number="68"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-69" data-line-number="69"><span class="co">#&gt; Predictions:</span></a>
<a class="sourceLine" id="cb32-70" data-line-number="70">preds</a>
<a class="sourceLine" id="cb32-71" data-line-number="71"><span class="co">#&gt; tensor([[ 69.3122,  80.2639],</span></a>
<a class="sourceLine" id="cb32-72" data-line-number="72"><span class="co">#&gt;         [ 73.7528,  97.2381],</span></a>
<a class="sourceLine" id="cb32-73" data-line-number="73"><span class="co">#&gt;         [118.3933, 124.7628],</span></a>
<a class="sourceLine" id="cb32-74" data-line-number="74"><span class="co">#&gt;         [ 89.6111,  93.0286],</span></a>
<a class="sourceLine" id="cb32-75" data-line-number="75"><span class="co">#&gt;         [ 47.3013,  80.6467]], grad_fn=&lt;AddBackward0&gt;)</span></a>
<a class="sourceLine" id="cb32-76" data-line-number="76"></a>
<a class="sourceLine" id="cb32-77" data-line-number="77"><span class="co"># Targets</span></a>
<a class="sourceLine" id="cb32-78" data-line-number="78"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Targets:</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb32-79" data-line-number="79"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-80" data-line-number="80"><span class="co">#&gt; Targets:</span></a>
<a class="sourceLine" id="cb32-81" data-line-number="81">targets</a>
<a class="sourceLine" id="cb32-82" data-line-number="82"><span class="co">#&gt; tensor([[ 56.,  70.],</span></a>
<a class="sourceLine" id="cb32-83" data-line-number="83"><span class="co">#&gt;         [ 81., 101.],</span></a>
<a class="sourceLine" id="cb32-84" data-line-number="84"><span class="co">#&gt;         [119., 133.],</span></a>
<a class="sourceLine" id="cb32-85" data-line-number="85"><span class="co">#&gt;         [ 22.,  37.],</span></a>
<a class="sourceLine" id="cb32-86" data-line-number="86"><span class="co">#&gt;         [103., 119.]])</span></a></code></pre></div>
<p>Notice that while in Python the tensor operation, gradient of the weights times the <strong>Learning Rate</strong>,</p>
<p><span class="math display">\[w = -w + \nabla w \; \alpha\]</span></p>
<p>is a very straight forwward and clean code:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb33-1" data-line-number="1">w <span class="op">-=</span> w.grad <span class="op">*</span> <span class="fl">1e-5</span></a></code></pre></div>
<p>In R shows a little bit more convoluted:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">w<span class="op">$</span>data &lt;-<span class="st"> </span>torch<span class="op">$</span><span class="kw">sub</span>(w<span class="op">$</span>data, torch<span class="op">$</span><span class="kw">mul</span>(w<span class="op">$</span>grad, torch<span class="op">$</span><span class="kw">scalar_tensor</span>(<span class="fl">1e-5</span>)))</a></code></pre></div>
</div>
</div>
<div id="transform-a-tensor" class="section level2">
<h2><span class="header-section-number">3.7</span> Transform a tensor</h2>
<p>Explain how transform a tensor back and forth to <code>numpy</code>.
Why is this important?</p>
</div>
<div id="build-a-model-class" class="section level2">
<h2><span class="header-section-number">3.8</span> Build a model class</h2>
<p>PyTorch classes cannot not directly instantiated from <code>R</code>. We need an intermediate step to create a class. For this, we use <code>reticulate</code> functions that will read the class implementation in <code>Python</code> code.</p>
<div id="example-1" class="section level3">
<h3><span class="header-section-number">3.8.1</span> Example 1</h3>
</div>
<div id="example-2" class="section level3">
<h3><span class="header-section-number">3.8.2</span> Example 2</h3>
</div>
</div>
<div id="convert-a-tensor-to-numpy-object" class="section level2">
<h2><span class="header-section-number">3.9</span> Convert a tensor to <code>numpy</code> object</h2>
<p>This is a frequent operation. I have found that this is necessary when</p>
<ul>
<li>a numpy function is not implemented in PyTorch</li>
<li>We need to convert a tensor to R</li>
<li>Perform a Boolean operation that is not directly available in PyTorch.</li>
</ul>
</div>
<div id="convert-a-numpy-object-to-an-r-object" class="section level2">
<h2><span class="header-section-number">3.10</span> Convert a <code>numpy</code> object to an <code>R</code> object</h2>
<p>This is mainly required for these reasons:</p>
<ol style="list-style-type: decimal">
<li>Create a data structure in R</li>
<li>Plot using r-base or ggplot2</li>
<li>Perform an analysis on parts of a tensor</li>
<li>Use R statistical functions that are not available in PyTorch.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tensors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["rtorch-book.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
